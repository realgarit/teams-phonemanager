<UserControl x:Class="teams_phonemanager.Views.VariablesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:teams_phonemanager.Views"
             xmlns:viewmodels="clr-namespace:teams_phonemanager.ViewModels"
             xmlns:converters="clr-namespace:teams_phonemanager.Converters"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <UserControl.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:TimeSpanConverter x:Key="TimeSpanConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Style for locked fields -->
        <Style x:Key="LockedFieldStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="IsReadOnly" Value="True"/>
        </Style>
        
        <!-- Style for semi-locked fields -->
        <Style x:Key="SemiLockedFieldStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}"/>
        </Style>
        
        <!-- Style for example text -->
        <Style x:Key="ExampleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <materialDesign:Card Margin="16" UniformCornerRadius="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Status Message -->
                <StackPanel Grid.Row="0" Margin="16,16,16,8">
                    <TextBlock Text="{Binding WelcomeMessage}"
                             Style="{StaticResource MaterialDesignBody1TextBlock}"
                             TextWrapping="Wrap"/>
                </StackPanel>

                <!-- Tab Control -->
                <TabControl Grid.Row="1" Style="{StaticResource MaterialDesignTabControl}">
                    
                    <!-- General Tab -->
                    <TabItem Header="General">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                            <Grid IsEnabled="{Binding CanProceed}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,8,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="Customer Legal Name"
                                             Text="{Binding Variables.CustomerLegalName, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: Acme Corp" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="4,8,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="MS Fallback Domain"
                                             Text="{Binding Variables.MsFallbackDomain, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: @acme.onmicrosoft.com" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="Customer"
                                             Text="{Binding Variables.Customer, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: acm-luc" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="4,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="Customer Group Name"
                                             Text="{Binding Variables.CustomerGroupName, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: immo" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="Language ID"
                                             Text="{Binding Variables.LanguageId, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: de-DE" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="2" Grid.Column="1" Margin="4,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="Time Zone ID"
                                             Text="{Binding Variables.TimeZoneId, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: W. Europe Standard Time" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="Usage Location"
                                             Text="{Binding Variables.UsageLocation, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: CH" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="3" Grid.Column="1" Margin="4,0,0,8">
                                    <Grid>
                                        <TextBox materialDesign:HintAssist.Hint="SKU ID"
                                                 Text="{Binding Variables.SkuId, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LockedFieldStyle}"/>
                                        <materialDesign:PackIcon Kind="Lock" 
                                                               HorizontalAlignment="Right" 
                                                               VerticalAlignment="Center" 
                                                               Margin="0,0,8,0"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Call Queues Tab -->
                    <TabItem Header="Call Queues">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                            <Grid IsEnabled="{Binding CanProceed}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,8,4,8">
                                    <Grid>
                                        <TextBox materialDesign:HintAssist.Hint="CS App CQ ID"
                                                 Text="{Binding Variables.CsAppCqId, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LockedFieldStyle}"/>
                                        <materialDesign:PackIcon Kind="Lock" 
                                                               HorizontalAlignment="Right" 
                                                               VerticalAlignment="Center" 
                                                               Margin="0,0,8,0"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Auto Attendants Tab -->
                    <TabItem Header="Auto Attendants">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                            <Grid IsEnabled="{Binding CanProceed}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,8,4,8">
                                    <Grid>
                                        <TextBox materialDesign:HintAssist.Hint="CS App AA ID"
                                                 Text="{Binding Variables.CsAppAaId, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LockedFieldStyle}"/>
                                        <materialDesign:PackIcon Kind="Lock" 
                                                               HorizontalAlignment="Right" 
                                                               VerticalAlignment="Center" 
                                                               Margin="0,0,8,0"/>
                                    </Grid>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="4,8,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="Phone Number Type"
                                             Text="{Binding Variables.PhoneNumberType, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: DirectRouting" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="RAAA Number Name"
                                             Text="{Binding Variables.RaaAnrName, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: hn for 'Hauptnummer'" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="RAAA Number"
                                             Text="{Binding Variables.RaaAnr, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: +41413290024" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="Default Call Flow Greeting Prompt (DE)"
                                             Text="{Binding Variables.DefaultCallFlowGreetingPromptDE, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: Herzlich Willkommen bei der Acme Corp!" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="After Hours Call Flow Greeting Prompt (DE)"
                                             Text="{Binding Variables.AfterHoursCallFlowGreetingPromptDE, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: Herzlich Willkommen bei der Acme Corp, Sie rufen ausserhalb der Öffnungszeiten." Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>

                                <TextBlock Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2"
                                         Text="Opening Hours 1"
                                         Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                         Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2"
                                         Text="Note: Both Opening Hours 1 and 2 currently apply to Monday through Friday."
                                         Style="{StaticResource ExampleTextStyle}"
                                         Margin="0,0,0,8"/>

                                <StackPanel Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,8">
                                    <StackPanel Width="100" Margin="0,0,8,0">
                                        <TextBox materialDesign:HintAssist.Hint="Start Time"
                                                 Text="{Binding Variables.OpeningHours1Start, Converter={StaticResource TimeSpanConverter}}"
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                        <TextBlock Text="Example: 08:00" Style="{StaticResource ExampleTextStyle}"/>
                                    </StackPanel>
                                    <StackPanel Width="100" Margin="0,0,0,0">
                                        <TextBox materialDesign:HintAssist.Hint="End Time"
                                                 Text="{Binding Variables.OpeningHours1End, Converter={StaticResource TimeSpanConverter}}"
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                        <TextBlock Text="Example: 12:00" Style="{StaticResource ExampleTextStyle}"/>
                                    </StackPanel>
                                </StackPanel>

                                <TextBlock Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="2"
                                         Text="Opening Hours 2"
                                         Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                         Margin="0,0,0,8"/>

                                <StackPanel Grid.Row="9" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,8">
                                    <StackPanel Width="100" Margin="0,0,8,0">
                                        <TextBox materialDesign:HintAssist.Hint="Start Time"
                                                 Text="{Binding Variables.OpeningHours2Start, Converter={StaticResource TimeSpanConverter}}"
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                        <TextBlock Text="Example: 13:30" Style="{StaticResource ExampleTextStyle}"/>
                                    </StackPanel>
                                    <StackPanel Width="100">
                                        <TextBox materialDesign:HintAssist.Hint="End Time"
                                                 Text="{Binding Variables.OpeningHours2End, Converter={StaticResource TimeSpanConverter}}"
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                        <TextBlock Text="Example: 17:00" Style="{StaticResource ExampleTextStyle}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Holidays Tab -->
                    <TabItem Header="Holidays">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                            <Grid IsEnabled="{Binding CanProceed}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,8,4,8">
                                    <Grid>
                                        <TextBox materialDesign:HintAssist.Hint="Holiday Name"
                                                 Text="{Binding Variables.HolidayNameSuffix, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource SemiLockedFieldStyle}">
                                            <TextBox.Template>
                                                <ControlTemplate TargetType="TextBox">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Border Grid.Column="0" 
                                                                Background="Transparent"
                                                                Padding="14,8,4,8"
                                                                BorderThickness="1,1,0,1"
                                                                BorderBrush="{DynamicResource MaterialDesignDivider}"
                                                                Opacity="0.7">
                                                            <TextBlock Text="{Binding Variables.Customer, StringFormat=hd-\{0\}-, FallbackValue=hd-}"
                                                                     VerticalAlignment="Center"
                                                                     Height="{Binding ActualHeight, ElementName=PART_ContentHost}"/>
                                                        </Border>
                                                        <Border Grid.Column="1"
                                                                Background="{TemplateBinding Background}"
                                                                BorderThickness="0,1,1,1"
                                                                BorderBrush="{TemplateBinding BorderBrush}">
                                                            <ScrollViewer x:Name="PART_ContentHost" 
                                                                        Focusable="false" 
                                                                        HorizontalScrollBarVisibility="Hidden" 
                                                                        VerticalScrollBarVisibility="Hidden"
                                                                        VerticalAlignment="Center"
                                                                        Padding="4,8,14,8"
                                                                        Margin="0"/>
                                                        </Border>
                                                    </Grid>
                                                </ControlTemplate>
                                            </TextBox.Template>
                                        </TextBox>
                                    </Grid>
                                    <TextBlock Text="Example: kantonal-2025" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="4,8,0,8">
                                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                            Command="{Binding OpenHolidaySeriesManagerCommand}"
                                            HorizontalAlignment="Stretch">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="CalendarMultiple" Margin="0,0,8,0"/>
                                            <TextBlock Text="Manage Holiday Series"/>
                                            <TextBlock Text="{Binding Variables.HolidaySeries.Count, StringFormat=' ({0} holidays)'}"
                                                     Margin="8,0,0,0"
                                                     Opacity="0.7"/>
                                        </StackPanel>
                                    </Button>
                                    <TextBlock Text="Click to manage multiple holiday dates and times" Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="Holiday Greeting Prompt (DE)"
                                             Text="{Binding Variables.HolidayGreetingPromptDE, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="Example: Herzlich Willkommen bei der Acme Corp. Leider können wir Ihren Anruf derzeit nicht entgegennehmen, da Sie uns an einem Feiertag anrufen." Style="{StaticResource ExampleTextStyle}"/>
                                </StackPanel>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Auto-generated Tab -->
                    <TabItem Header="Auto-generated">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                            <Grid IsEnabled="{Binding CanProceed}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Grid.Column="0" Margin="0,8,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="M365 Group"
                                             Text="{Binding Variables.M365Group, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                                
                                <Grid Grid.Row="0" Grid.Column="1" Margin="4,8,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="RACQ UPN"
                                             Text="{Binding Variables.RacqUPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                                
                                <Grid Grid.Row="1" Grid.Column="0" Margin="0,0,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="RACQ Display Name"
                                             Text="{Binding Variables.RacqDisplayName, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                                
                                <Grid Grid.Row="1" Grid.Column="1" Margin="4,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="CQ Display Name"
                                             Text="{Binding Variables.CqDisplayName, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                                
                                <Grid Grid.Row="2" Grid.Column="0" Margin="0,0,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="RAAA UPN"
                                             Text="{Binding Variables.RaaaUPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                                
                                <Grid Grid.Row="2" Grid.Column="1" Margin="4,0,0,8">
                                    <TextBox materialDesign:HintAssist.Hint="RAAA Display Name"
                                             Text="{Binding Variables.RaaaDisplayName, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                                
                                <Grid Grid.Row="3" Grid.Column="0" Margin="0,0,4,8">
                                    <TextBox materialDesign:HintAssist.Hint="AA Display Name"
                                             Text="{Binding Variables.AaDisplayName, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource LockedFieldStyle}"/>
                                    <materialDesign:PackIcon Kind="Lock" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>

                <!-- Save and Load Buttons -->
                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Margin="16,8,16,16">
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Command="{Binding LoadVariablesFromFileCommand}"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FolderOpen" Margin="0,0,8,0"/>
                            <TextBlock Text="Load Variables from File"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignRaisedButton}"
                            Command="{Binding SaveVariablesToFileCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ContentSave" Margin="0,0,8,0"/>
                            <TextBlock Text="Save Variables to File"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>
        
        <!-- Holiday Time Picker Popup -->
        <materialDesign:DialogHost Grid.RowSpan="3" 
                                 IsOpen="{Binding ShowHolidayTimePicker}">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="16" MinWidth="300">
                    <TextBlock Text="Select Holiday Time"
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                             Margin="0,0,0,16"/>
                    
                    <TextBlock Text="Choose a time that aligns with 15-minute boundaries:"
                             Style="{StaticResource MaterialDesignBody2TextBlock}"
                             TextWrapping="Wrap"
                             Margin="0,0,0,16"/>
                    
                    <ComboBox ItemsSource="{Binding TimeOptions}"
                            SelectedItem="{Binding SelectedHolidayTime, Mode=TwoWay}"
                            Style="{StaticResource MaterialDesignOutlinedComboBox}"
                            materialDesign:HintAssist.Hint="Select time"
                            Margin="0,0,0,16">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding StringFormat='{}{0:hh\\:mm}'}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <StackPanel Orientation="Horizontal" 
                              HorizontalAlignment="Right">
                        <Button Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CloseHolidayTimePickerCommand}"
                                Margin="0,0,8,0">
                            <TextBlock Text="Cancel"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding SaveHolidayTimeCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Check" Margin="0,0,8,0"/>
                                <TextBlock Text="Save Time"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
        
        <!-- Holiday Series Manager Popup -->
        <materialDesign:DialogHost Grid.RowSpan="3" 
                                 IsOpen="{Binding ShowHolidaySeriesManager}">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="16" MinWidth="600" MaxWidth="800">
                    <TextBlock Text="Manage Holiday Series"
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                             Margin="0,0,0,16"/>
                    
                    <TextBlock Text="Add, edit, or remove holiday dates and times. Each holiday will be created with the specified date and time."
                             Style="{StaticResource MaterialDesignBody2TextBlock}"
                             TextWrapping="Wrap"
                             Margin="0,0,0,16"/>

                    <TextBlock Text="If no time is selected, 00:00 will be used by default."
                             Style="{StaticResource MaterialDesignCaptionTextBlock}"
                             Opacity="0.7"
                             Margin="0,0,0,16"/>
                    
                    <!-- Holiday List -->
                    <ScrollViewer MaxHeight="300" Margin="0,0,0,16">
                        <ItemsControl ItemsSource="{Binding Variables.HolidaySeries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="{DynamicResource MaterialDesignDivider}"
                                            BorderThickness="0,0,0,1"
                                            Padding="0,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding DisplayText}"
                                                         Style="{StaticResource MaterialDesignSubtitle2TextBlock}"/>
                                                <TextBlock Text="{Binding Name, StringFormat='Holiday: {0}'}"
                                                         Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                                         Opacity="0.7"
                                                         Visibility="{Binding Name, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            </StackPanel>
                                            
                                            <Button Grid.Column="1"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.EditHolidayCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    Margin="8,0">
                                                <materialDesign:PackIcon Kind="Edit"/>
                                            </Button>
                                            
                                            <Button Grid.Column="2"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.RemoveHolidayCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    Margin="8,0">
                                                <materialDesign:PackIcon Kind="Delete"/>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Add Holiday and Delete All Buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                Command="{Binding AddHolidayCommand}"
                                Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Plus" Margin="0,0,8,0"/>
                                <TextBlock Text="Add Holiday"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                Command="{Binding DeleteAllHolidaysCommand}"
                                Background="{DynamicResource MaterialDesignValidationErrorBrush}"
                                Foreground="White">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="DeleteSweep" Margin="0,0,8,0"/>
                                <TextBlock Text="Delete All"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    
                    <!-- Use Predefined Sets Button -->
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Command="{Binding OpenPredefinedHolidaysWizardCommand}"
                            HorizontalAlignment="Left"
                            Margin="0,0,0,16">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="PlaylistPlus" Margin="0,0,8,0"/>
                            <TextBlock Text="Use Predefined Sets…"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal" 
                              HorizontalAlignment="Right">
                        <Button Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CancelHolidaySeriesManagerCommand}"
                                Margin="0,0,8,0">
                            <TextBlock Text="Cancel"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding SaveHolidaySeriesCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Check" Margin="0,0,8,0"/>
                                <TextBlock Text="Save Series"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
        
        <!-- Edit Holiday Dialog -->
        <materialDesign:DialogHost Grid.RowSpan="3" 
                                 IsOpen="{Binding ShowEditHolidayDialog}">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="16" MinWidth="400">
                    <TextBlock Text="Edit Holiday"
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                             Margin="0,0,0,16"/>
                    
                    <TextBlock Text="Holiday Date:"
                             Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                             Margin="0,0,0,8"/>
                    <DatePicker SelectedDate="{Binding DialogHolidayDate, TargetNullValue={x:Static sys:DateTime.Today}}"
                              Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                              Margin="0,0,0,16"/>
                    
                    <TextBlock Text="Holiday Time:"
                             Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                             Margin="0,0,0,8"/>
                    <ComboBox ItemsSource="{Binding TimeOptions}"
                             SelectedItem="{Binding SelectedEditHolidayTime, Mode=TwoWay}"
                             Style="{StaticResource MaterialDesignOutlinedComboBox}"
                             materialDesign:HintAssist.Hint="Select time"
                             Margin="0,0,0,16">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding StringFormat='{}{0:hh\\:mm}'}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <StackPanel Orientation="Horizontal" 
                              HorizontalAlignment="Right">
                        <Button Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CancelEditHolidayCommand}"
                                Margin="0,0,8,0">
                            <TextBlock Text="Cancel"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding SaveEditHolidayCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Check" Margin="0,0,8,0"/>
                                <TextBlock Text="Save"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>

        <!-- Predefined Holidays Wizard Dialog -->
        <materialDesign:DialogHost Grid.RowSpan="3"
                                   IsOpen="{Binding ShowPredefinedHolidaysWizard}">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="16" MinWidth="500" MaxWidth="700">
                    <TextBlock Text="Predefined Holiday Sets"
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               Margin="0,0,0,16"/>

                    <TextBlock Text="Country" Style="{StaticResource MaterialDesignSubtitle2TextBlock}"/>
                    <ComboBox ItemsSource="{Binding Countries}"
                              SelectedItem="{Binding SelectedCountry}"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              Margin="0,0,0,16"/>

                    <StackPanel Visibility="{Binding IsSwitzerlandSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Canton" Style="{StaticResource MaterialDesignSubtitle2TextBlock}" VerticalAlignment="Center"/>
                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding ShowAargauInfoCommand}"
                                    Visibility="{Binding IsAargauSelected, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Margin="8,0,0,0"
                                    ToolTip="Aargau Holiday Reference Information">
                                <materialDesign:PackIcon Kind="Information" Foreground="#FFD700"/>
                            </Button>
                            <!-- Animated arrow pointing to info button -->
                            <StackPanel Orientation="Horizontal" 
                                        Visibility="{Binding IsAargauSelected, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        Margin="8,0,0,0"
                                        VerticalAlignment="Center">
                                <materialDesign:PackIcon Kind="ArrowLeft" 
                                                         Foreground="#FFD700" 
                                                         Width="16" 
                                                         Height="16"
                                                         VerticalAlignment="Center">
                                    <materialDesign:PackIcon.RenderTransform>
                                        <TranslateTransform/>
                                    </materialDesign:PackIcon.RenderTransform>
                                    <materialDesign:PackIcon.Style>
                                        <Style TargetType="materialDesign:PackIcon">
                                            <Style.Triggers>
                                                <EventTrigger RoutedEvent="Loaded">
                                                    <BeginStoryboard>
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X"
                                                                             From="0" To="-4" Duration="0:0:0.8"
                                                                             AutoReverse="True"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </materialDesign:PackIcon.Style>
                                </materialDesign:PackIcon>
                                <TextBlock Text="Click for reference" 
                                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                                           Foreground="#FFD700"
                                           Opacity="0.9"
                                           Margin="4,0,0,0"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                        <ComboBox ItemsSource="{Binding Cantons}"
                                  SelectedItem="{Binding SelectedCanton}"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                  Margin="0,0,0,16"/>

                        <StackPanel Visibility="{Binding IsAargauSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="Bezirk" Style="{StaticResource MaterialDesignSubtitle2TextBlock}"/>
                            <ComboBox ItemsSource="{Binding Bezirke}"
                                      SelectedItem="{Binding SelectedBezirk}"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      Margin="0,0,0,16"/>
                        </StackPanel>
                    </StackPanel>

                    <TextBlock Text="Year" Style="{StaticResource MaterialDesignSubtitle2TextBlock}"/>
                    <ComboBox ItemsSource="{Binding Years}"
                              SelectedItem="{Binding SelectedYear}"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              Margin="0,0,0,16"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CancelPredefinedHolidaysWizardCommand}"
                                Margin="0,0,8,0">
                            <TextBlock Text="Cancel"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding ApplyPredefinedHolidaysCommand}"
                                IsEnabled="{Binding CanApplyPredefinedSelection}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Check" Margin="0,0,8,0"/>
                                <TextBlock Text="Add Holidays"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>

        <!-- Aargau Info Dialog -->
        <materialDesign:DialogHost Grid.RowSpan="3"
                                   IsOpen="{Binding ShowAargauInfoDialog}">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="16" MinWidth="600" MaxWidth="800">
                    <TextBlock Text="Aargau Holiday Reference"
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               Margin="0,0,0,16"/>

                    <TextBlock Text="Use this as a reference image because the holidays in Aargau can vary yearly. Please look up the official page of the DEPARTEMENT VOLKSWIRTSCHAFT UND INNERES, Amt für Wirtschaft und Arbeit of Kanton Aargau to get the newest list."
                               Style="{StaticResource MaterialDesignBody2TextBlock}"
                               TextWrapping="Wrap"
                               Margin="0,0,0,16"/>

                    <Border BorderBrush="{DynamicResource MaterialDesignDivider}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Margin="0,0,0,16">
                        <Image Source="pack://application:,,,/Resources/AargauHolidaysReference.png"
                               Stretch="Uniform"
                               MaxHeight="400"/>
                    </Border>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding CloseAargauInfoCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Check" Margin="0,0,8,0"/>
                                <TextBlock Text="Close"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
    </Grid>
</UserControl>